string(REPLACE "\\" "" MATER_EXEC "${EXEC}")

set(CBDIR "@CMAKE_CURRENT_BINARY_DIR@")
set(CSDIR "@CMAKE_CURRENT_SOURCE_DIR@")

set(OUTPUT_FILES
  "${CBDIR}/ged_mater_density_data.txt"
  "${CBDIR}/ged_mater_density_export.txt"
  "${CBDIR}/ged_mater_density_map.txt"
  "${CBDIR}/ged_mater_density_reverse_map.txt"
  "${CBDIR}/ged_mater_test.g"
  )

# Clean up in case we've run before unsuccessfully
foreach(of ${OUTPUT_FILES})
  execute_process(COMMAND "@CMAKE_COMMAND@" -E remove -f "${of}")
endforeach(of ${OUTPUT_FILES})

file(WRITE "${CBDIR}/regress-ged_mater.log" "Running ${MATER_EXEC} dnull\n")
execute_process(
  COMMAND "${MATER_EXEC}" "dnull" RESULT_VARIABLE ged_mater_result
  OUTPUT_VARIABLE ged_mater_log ERROR_VARIABLE ged_mater_log
  WORKING_DIRECTORY ${CBDIR}
  )
file(APPEND "${CBDIR}/regress-ged_mater.log" "${ged_mater_log}")
if(ged_mater_result)
  message(FATAL_ERROR "[regress-ged_mater] Failure: ${ged_mater_result}. See ${CBDIR}/regress-ged_mater.log for more info.\n")
endif(ged_mater_result)

execute_process(COMMAND "@CMAKE_COMMAND@" -E remove "${CBDIR}/ged_mater_test.g")

file(APPEND "${CBDIR}/regress-ged_mater.log" "Running ${MATER_EXEC} dstd\n")
execute_process(
  COMMAND "${MATER_EXEC}" "dstd" RESULT_VARIABLE ged_mater_result
  OUTPUT_VARIABLE ged_mater_log ERROR_VARIABLE ged_mater_log
  WORKING_DIRECTORY ${CBDIR}
  )
file(APPEND "${CBDIR}/regress-ged_mater.log" "${ged_mater_log}")

if(ged_mater_result)
  message(FATAL_ERROR "[regress-ged_mater] Failure: ${ged_mater_result}. See ${CBDIR}/regress-ged_mater.log for more info.\n")
endif(ged_mater_result)

# Clean up
foreach(of ${OUTPUT_FILES})
  file(APPEND "${CBDIR}/regress-ged_mater.log" "Removing ${of}\n")
  execute_process(COMMAND "@CMAKE_COMMAND@" -E remove -f "${of}")
endforeach(of ${OUTPUT_FILES})

# Local Variables:
# tab-width: 8
# mode: cmake
# indent-tabs-mode: t
# End:
# ex: shiftwidth=2 tabstop=8

