# Empty elements in lists are of no interest
IF(COMMAND CMAKE_POLICY)
	CMAKE_POLICY(SET CMP0007 OLD)
ENDIF(COMMAND CMAKE_POLICY)

FILE(READ ${CMAKE_BINARY_DIR}/CMakeTmp/distchecklist.cmake DISTCHECK_STRING_ORIG)
STRING(REPLACE "\\" "\;" DISTCHECK_LIST_ORIG ${DISTCHECK_STRING_ORIG})
SET(CMAKE_ORIG_SRC_DIR @CMAKE_SOURCE_DIR@)
SET(CMAKE_ORIG_BINARY_DIR @CMAKE_BINARY_DIR@)
STRING(REPLACE "${CMAKE_ORIG_SRC_DIR}" "" DISTCHECK_LIST ${DISTCHECK_LIST_ORIG})
FOREACH(DIR ${DISTCHECK_LIST})
	SET(DIFFLIST "")
	SET(ALL_DIR_FILES "")
	IF(EXISTS ${CMAKE_ORIG_BINARY_DIR}${DIR}/cmakefiles.cmake)
		FILE(READ ${CMAKE_ORIG_BINARY_DIR}${DIR}/cmakefiles.cmake DIR_FILES_STRING_ORIG)
		STRING(REPLACE "\\" "\;" DIR_FILES_LIST ${DIR_FILES_STRING_ORIG})
		LIST(REMOVE_DUPLICATES DIR_FILES_LIST)
		LIST(SORT DIR_FILES_LIST)
		FILE(GLOB ALL_DIR_FILES_PATH "${CMAKE_ORIG_SRC_DIR}${DIR}/*" )
		FOREACH(ITEM ${ALL_DIR_FILES_PATH})
			GET_FILENAME_COMPONENT(ITEM_NAME ${ITEM} NAME)
			LIST(APPEND ALL_DIR_FILES ${ITEM_NAME})
		ENDFOREACH(ITEM ${ALL_DIR_FILES_PATH})
		LIST(SORT ALL_DIR_FILES)
		FOREACH(ITEM ${ALL_DIR_FILES})
			LIST(FIND DIR_FILES_LIST ${ITEM} ISLISTED)
			IF(ISLISTED MATCHES "-1")
				IF(NOT ${ITEM} MATCHES "CMakeLists"
						AND NOT ${ITEM} MATCHES "Makefile.am"
						AND NOT ${ITEM} MATCHES ".svn")
					SET(DIFFLIST ${DIFFLIST} ${ITEM})
				ENDIF()
			ENDIF(ISLISTED MATCHES "-1")
		ENDFOREACH(ITEM ${ALL_DIR_FILES})
		IF(DIFFLIST)
			MESSAGE(WARNING "${CMAKE_ORIG_SRC_DIR}${DIR}:\nDIFFLIST: ${DIFFLIST}")
		ENDIF(DIFFLIST)
	ELSE()
		#MESSAGE("Note: No cmakefiles.cmake present in ${CMAKE_ORIG_SRC_DIR}${DIR}")
	ENDIF()
ENDFOREACH(DIR ${DISTCHECK_LIST})


