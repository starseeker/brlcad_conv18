<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- lifted from troff+man by doclifter -->
<refentry xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en' xml:id='colorquant3'>
<refmeta>
<refentrytitle>COLORQUANT</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo class='source'>August 14, 1989</refmiscinfo>
</refmeta>
<refnamediv>
<refname>colorquant</refname>
<refpurpose>variance-based color quantization</refpurpose>
</refnamediv>
<!-- body begins here -->
<refsynopsisdiv xml:id='synopsis'>
<funcsynopsis>
<funcsynopsisinfo>
#include &lt;colorquant.h&gt;
</funcsynopsisinfo>
<funcprototype>
<funcdef>int <function>colorquant</function></funcdef>
<paramdef><parameter>red</parameter></paramdef>
<paramdef><parameter>green</parameter></paramdef>
<paramdef><parameter>blue</parameter></paramdef>
<paramdef><parameter>npix</parameter></paramdef>
<paramdef><parameter>colormap</parameter></paramdef>
<paramdef><parameter>colors</parameter></paramdef>
<paramdef><parameter>bits</parameter></paramdef>
<paramdef><parameter>rgbmap</parameter></paramdef>
<paramdef><parameter>flags</parameter></paramdef>
<paramdef><parameter>accum_hist</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

unsigned char *red, *green, *blue;

unsigned long npix;

unsigned char *colormap[3];

int colors, bits;

unsigned char *rgbmap;

int flags;

int accum_hist;


</funcsynopsisinfo>
</funcsynopsis>
</refsynopsisdiv>


<refsect1 xml:id='description'><title>DESCRIPTION</title>
<para><emphasis remap='I'>Colorquant</emphasis>
performs variance-based color quantization on a given image.
A representative colormap
and a table for performing RGB to colormap index mapping are computed.  The
number of colors to which the image was quantized (the total number
of colormap entries computed) is returned.
The arguments to
<function>colorquant</function>
are:</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='I'>red, green, blue</emphasis></term>
  <listitem>
<para>The red, green and blue channels of the image.  The ith pixel is represented
as the RGB triple (<emphasis remap='I'>red</emphasis>[i], <emphasis remap='I'>green</emphasis>[i], <emphasis remap='I'>blue</emphasis>[i]).  These
arrays usually contain values that have been 'prequantized' (see below).</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>npix</emphasis></term>
  <listitem>
<para>The length, in bytes, of the <emphasis remap='I'>red</emphasis>, <emphasis remap='I'>green</emphasis> and <emphasis remap='I'>blue</emphasis> arrays.
Equal to the total number of pixels in the image.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>colormap</emphasis></term>
  <listitem>
<para>Points to a pre-allocated, three-channel colormap.  These arrays will be
filled with the colormap values computed by the variance-based color
quantization algorithm.  <emphasis remap='I'>colormap</emphasis>[0][i], <emphasis remap='I'>colormap</emphasis>[1][i], and
<emphasis remap='I'>colormap</emphasis>[2][i] are, respectively, the red, green and blue components
of the ith colormap entry.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>colors</emphasis></term>
  <listitem>
<para>The number of pre-allocated colormap entries.  The image will be quantized to
at most this many colors.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>bits</emphasis></term>
  <listitem>
<para>The number of significant bits in each entry of the <emphasis remap='I'>red</emphasis>, <emphasis remap='I'>green</emphasis> and
<emphasis remap='I'>blue</emphasis> arrays.  Normally, the red, green and blue arrays contain
values that have been prequantized to fewer than eight
significant bits (see <emphasis remap='I'>flags</emphasis> below).
Five significant bits usually represents a good tradeoff between image quality
and running time.  Anything above six significant bits will likely lead to
excessive paging, as the size of <emphasis remap='I'>rgbmap</emphasis> and the internal histogram are
proportional to (2^<emphasis remap='I'>bits</emphasis>)^3.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>rgbmap</emphasis></term>
  <listitem>
<para>A pointer to an array of unsigned chars of size (2^<emphasis remap='I'>bits</emphasis>)^3.
This array is used
to map from pixels to colormap entries.  The prequantized red, green
and blue components of a pixel are used as an index into this array
to retrieve the colormap index that should be used to represent the
pixel.  The array is indexed as:
<!-- .ce 1 -->
colorindex = <emphasis remap='I'>rgbmap</emphasis>[(((r &lt;&lt; <emphasis remap='I'>bits</emphasis>) | g) &lt;&lt; <emphasis remap='I'>bits</emphasis>) | b];
where r, g, and b are the prequantized red, green and blue components of
the pixel in question.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>flags</emphasis></term>
  <listitem>
<para>A collection of bit-flags that modify the operation of
<function>colorquant</function>.  Currently defined values are <emphasis remap='B'>CQ_FAST</emphasis>,
<emphasis remap='B'>CQ_QUANTIZE</emphasis>, and <emphasis remap='B'>CQ_NO_RGBMAP</emphasis>.
<!-- .br -->
If <emphasis remap='B'>CQ_FAST</emphasis> is set, the construction of <emphasis remap='I'>rgbmap</emphasis> will be
relatively fast.  If not, <emphasis remap='I'>rgbmap</emphasis> will be built slowly but more
accurately.  In most cases, the error introduced by the 'fast'
approximation is barely noticeable.
<!-- .br -->
If <emphasis remap='B'>CQ_QUANTIZE</emphasis> is set, the values in <emphasis remap='I'>red</emphasis>, <emphasis remap='I'>green</emphasis>, and
<emphasis remap='I'>blue</emphasis> are taken as 8-bit values and will be quantized to
<emphasis remap='I'>bits</emphasis> significant bits by <function>colorquant</function>.  If not set, these
values are assumed to be prequantized.
<!-- .br -->
If <emphasis remap='B'>CQ_NO_RGBMAP</emphasis> is set, <emphasis remap='I'>rgbmap</emphasis> will not be built.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='I'>accum_hist</emphasis></term>
  <listitem>
<para>This argument provides a facility to accumulate multiple images into a
single colormap.  If
<emphasis remap='I'>accum_hist</emphasis>
is zero, the routine works normally.  To build a colormap for several
images, <emphasis remap='I'>accum_hist</emphasis> should have the value 1 for the first image,
and 2 for subsequent images.  Finally, after all the images have been
processed, a value of 3 for <emphasis remap='I'>accum_hist</emphasis> will compute the
<emphasis remap='I'>colormap</emphasis> and <emphasis remap='I'>rgbmap</emphasis>.  The values of <emphasis remap='I'>colors</emphasis> and
<emphasis remap='I'>bits</emphasis> should not change during this process.  The arguments
<emphasis remap='I'>colormap</emphasis>, <emphasis remap='I'>rgbmap</emphasis>, and <emphasis remap='I'>fast</emphasis> are ignored if
<emphasis remap='I'>accum_hist</emphasis> is 1 or 2, and
<emphasis remap='I'>red</emphasis>,
<emphasis remap='I'>green</emphasis>,
<emphasis remap='I'>blue</emphasis>,
and
<emphasis remap='I'>npix</emphasis>
are ignored if <emphasis remap='I'>accum_hist</emphasis> is 3.</para>
  </listitem>
  </varlistentry>
</variablelist>
</refsect1>

<refsect1 xml:id='author'><title>AUTHOR</title>
<para>Craig Kolb, Yale University.
<!-- .br -->
Martin Friedmann, MIT Media Lab did the <emphasis remap='I'>accum_hist</emphasis> changes.</para>
</refsect1>

<refsect1 xml:id='reference'><title>REFERENCE</title>
<para>Wan, Wong, and Prusinkiewicz,
<emphasis remap='I'>An Algorithm for Multidimensional Data Clustering,</emphasis>
Transactions on Mathematical Software, Vol. 14 #2 (June, 1988), pp. 153-162.</para>
</refsect1>

<refsect1 xml:id='see_also'><title>SEE ALSO</title>
<para><citerefentry><refentrytitle>rlequant</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
<citerefentry><refentrytitle>inv_cmap</refentrytitle><manvolnum>3</manvolnum></citerefentry>.</para>
</refsect1>
</refentry>

