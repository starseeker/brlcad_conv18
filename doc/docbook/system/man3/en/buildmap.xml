<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- lifted from troff+man by doclifter -->
<refentry xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en' xml:id='buildmap3'>
<!--  Copyright (c) 1986, University of Utah -->
<refentryinfo><date>3/6/85</date></refentryinfo>
<refmeta>
<refentrytitle>BUILDMAP</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo class='date'>3/6/85</refmiscinfo>
<refmiscinfo class='source'>3</refmiscinfo>
</refmeta>
<refnamediv>
<refname>buildmap</refname>
<refpurpose>create a color map array from an RLE file header.</refpurpose>
</refnamediv>
<!-- body begins here -->
<refsynopsisdiv xml:id='synopsis'>
<funcsynopsis>
<funcsynopsisinfo>
#include &lt;rle.h&gt;
</funcsynopsisinfo>
<funcprototype>
<funcdef><function>rle_pixel</function> **buildmap</funcdef>
<paramdef><parameter>the_hdr</parameter></paramdef>
<paramdef><parameter>minmap</parameter></paramdef>
<paramdef><parameter>orig_gamma</parameter></paramdef>
<paramdef><parameter>new_gamma</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

rle_hdr * the_hdr;

int minmap;

double orig_gamma, new_gamma;


</funcsynopsisinfo>
</funcsynopsis>
</refsynopsisdiv>


<refsect1 xml:id='description'><title>DESCRIPTION</title>
<para>The color map in the
<citerefentry><refentrytitle>rle_hdr</refentrytitle><manvolnum>3</manvolnum></citerefentry>
structure is not in the most easily used form.  The function
<emphasis remap='I'>buildmap</emphasis>
returns a pointer to a colormap array with certain minimum dimensions,
making it a little easier to implement color mapping in a program.
The color map from first argument,
<emphasis remap='I'>the_hdr</emphasis>,
is used to build the result.  If no map is present in
<emphasis remap='I'>the_hdr</emphasis>,
then an identity map of the minimum size will be returned.</para>

<para>The returned color map will have at least
<emphasis remap='I'>minmap</emphasis>
rows or channels, each of which is at least 256 entries long (so that
indexing into the color map with an 8 bit
<function>rle_pixel</function>
value will always succeed.)</para>

<para>The color map from
<emphasis remap='I'>the_hdr</emphasis>
will be composed with a gamma compensation curve to account for the
gamma of the display for which the input color map was presumably computed.
The argument
<emphasis remap='I'>orig_gamma</emphasis>
specifies the gamma of the compensation curve.  It would typically be
the gamma of the original display.</para>

<para>If
<emphasis remap='I'>gamma</emphasis>
is 0, then if a picture comment
<emphasis remap='I'>image_gamma=i_gamma</emphasis>
is present, <emphasis remap='I'>gamma</emphasis> will be set to <emphasis remap='I'>1.0/i_gamma</emphasis>.
Otherwise, if a comment
<emphasis remap='I'>display_gamma=d_gamma</emphasis>
is present, <emphasis remap='I'>gamma</emphasis> will be set to <emphasis remap='I'>d_gamma</emphasis>.  The gamma
compensation value for pixel <emphasis remap='I'>i</emphasis> is <emphasis remap='I'>255*(i/255)^gamma</emphasis>.</para>

<para>If this color map will be used directly for another display, the gamma
of this new display should be passed in
<emphasis remap='I'>new_gamma</emphasis>.</para>

<para>The returned value is a pointer to an array of pointers to arrays of
<function>rle_pixel</function>
values.  It may be doubly indexed in C code, so that if
<emphasis remap='I'>cmap</emphasis>
is the return value, the RGB color mapping for a pixel
<emphasis remap='I'>pixval</emphasis>
is
<emphasis remap='I'>(cmap[0][pixval], cmap[1][pixval], cmap[2][pixval])</emphasis>.</para>
</refsect1>

<refsect1 xml:id='notes'><title>NOTES</title>
<para>Generally, unless the user explicitly specifies the image or original
display gamma (e.g., as with the <option>-i</option> or <option>-I</option> flags of
<citerefentry><refentrytitle>getx11</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
you should pass 0 for
<emphasis remap='I'>orig_gamma</emphasis>.
This lets
<emphasis remap='I'>buildmap</emphasis>
use the value from <emphasis remap='I'>the_hdr</emphasis>, if it is present.</para>

<para>If you are going to use the result of buildmap to generate values to
be dithered,
<emphasis remap='I'>new_gamma</emphasis>
should always be 1.0, and the display gamma (<option>-g</option> in
<emphasis remap='I'>getx11</emphasis>)
should be passed to
<citerefentry><refentrytitle>dithermap</refentrytitle><manvolnum>3</manvolnum></citerefentry>.
If you are not planning to dither, then pass the
user supplied display gamma as
<emphasis remap='I'>new_gamma</emphasis>.</para>

<para>The color map storage allocated by <emphasis remap='I'>buildmap</emphasis> can be released by
calling <emphasis remap='I'>free( map[0] )</emphasis>.</para>
</refsect1>

<refsect1 xml:id='see_also'><title>SEE ALSO</title>
<para><citerefentry><refentrytitle>dithermap</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
<citerefentry><refentrytitle>rle_hdr</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
<citerefentry><refentrytitle>librle</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
<citerefentry><refentrytitle>RLE</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
</refsect1>

<refsect1 xml:id='author'><title>AUTHOR</title>
<para>Spencer W. Thomas,
University of Utah</para>
</refsect1>
</refentry>

