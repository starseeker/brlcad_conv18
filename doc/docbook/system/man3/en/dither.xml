<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- lifted from troff+man by doclifter -->
<refentry xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en' xml:id='dither3'>
<!--  Copyright (c) 1986, 1987, University of Utah -->
<refentryinfo><date>2/2/87</date></refentryinfo>
<refmeta>
<refentrytitle>DITHER</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo class='date'>2/2/87</refmiscinfo>
<refmiscinfo class='source'>3</refmiscinfo>
</refmeta>
<refnamediv>
<refname>dithermap</refname>
<refname>bwdithermap</refname>
<refname>make_square</refname>
<refname>dithergb</refname>
<refname>ditherbw</refname>
<refpurpose>functions for dithering color or black and white images.</refpurpose>
</refnamediv>
<!-- body begins here -->
<refsynopsisdiv xml:id='synopsis'>
<funcsynopsis>

<funcprototype>
<funcdef><function>dithermap</function></funcdef>
<paramdef><parameter>levels</parameter></paramdef>
<paramdef><parameter>gamma</parameter></paramdef>
<paramdef><parameter>rgbmap</parameter></paramdef>
<paramdef><parameter>divN</parameter></paramdef>
<paramdef><parameter>modN</parameter></paramdef>
<paramdef><parameter>magic</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

int levels;

double gamma;

int rgbmap[][3], divN[256], modN[256], magic[16][16];

</funcsynopsisinfo>
<funcprototype>
<funcdef><function>bwdithermap</function></funcdef>
<paramdef><parameter>levels</parameter></paramdef>
<paramdef><parameter>gamma</parameter></paramdef>
<paramdef><parameter>bwmap</parameter></paramdef>
<paramdef><parameter>divN</parameter></paramdef>
<paramdef><parameter>modN</parameter></paramdef>
<paramdef><parameter>magic</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

int levels;

double gamma;

int bwmap[], int divN[256], modN[256], magic[16][16];

</funcsynopsisinfo>
<funcprototype>
<funcdef><function>make_square</function></funcdef>
<paramdef><parameter>N</parameter></paramdef>
<paramdef><parameter>divN</parameter></paramdef>
<paramdef><parameter>modN</parameter></paramdef>
<paramdef><parameter>magic</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

double N;

int divN[256], modN[256], magic[16][16];

</funcsynopsisinfo>
<funcprototype>
<funcdef><function>dithergb</function></funcdef>
<paramdef><parameter>x</parameter></paramdef>
<paramdef><parameter>y</parameter></paramdef>
<paramdef><parameter>r</parameter></paramdef>
<paramdef><parameter>g</parameter></paramdef>
<paramdef><parameter>b</parameter></paramdef>
<paramdef><parameter>levels</parameter></paramdef>
<paramdef><parameter>divN</parameter></paramdef>
<paramdef><parameter>modN</parameter></paramdef>
<paramdef><parameter>magic</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

int x, y, r, g, b, levels;

int divN[256], modN[256], magic[16][16];

</funcsynopsisinfo>
<funcprototype>
<funcdef><function>ditherbw</function></funcdef>
<paramdef><parameter>x</parameter></paramdef>
<paramdef><parameter>y</parameter></paramdef>
<paramdef><parameter>val</parameter></paramdef>
<paramdef><parameter>divN</parameter></paramdef>
<paramdef><parameter>modN</parameter></paramdef>
<paramdef><parameter>magic</parameter></paramdef>
</funcprototype>
<funcsynopsisinfo>

int x, y, val, divN[256], modN[256], magic[16][16];
</funcsynopsisinfo>
</funcsynopsis>
</refsynopsisdiv>


<refsect1 xml:id='description'><title>DESCRIPTION</title>
<para>These functions provide a common set of routines for dithering a full
color or gray scale image into a lower resolution color map.</para>

<para><emphasis remap='I'>Dithermap</emphasis>
computes a color map and some auxiliary parameters for dithering a
full color (24 bit) image to fewer bits.  The argument
<emphasis remap='I'>levels</emphasis>
tells how many different intensity levels per primary color should be
computed.  To get maximum use of a 256 entry color map, use
<emphasis remap='I'>levels</emphasis>=6.
The computed map uses <emphasis remap='I'>levels^3</emphasis> entries.
The
<emphasis remap='I'>gamma</emphasis>
argument provides for gamma compensation of the generated color map
(that is, the values in the map will be adjusted to give a linear
intensity variation on a display with the given gamma).
The computed color map will be returned in the array
<emphasis remap='I'>rgbmap</emphasis>.
<emphasis remap='I'>divN</emphasis>
and
<emphasis remap='I'>modN</emphasis>
are auxiliary arrays for computing the dithering pattern (see below),
and
<emphasis remap='I'>magic</emphasis>
is the magic square dither pattern.</para>

<para>To compute a color map for dithering a black and white image to fewer
intensity levels, use
<function>bwdithermap</function>.
The arguments are as for
<function>dithermap</function>,
but only a single channel color map is computed.  The value of
<emphasis remap='I'>levels</emphasis> can be larger than for <function>dithermap</function>, as
the computed map only has <emphasis remap='I'>levels</emphasis> entries.</para>

<para>To just build the magic square and other parameters, use
<function>make_square</function>.
The argument
<emphasis remap='I'>N</emphasis>
should be equal to 255.0 divided by the desired number of intensity
levels less one (i.e., <emphasis remap='I'>N = 255.0 / (levels - 1)</emphasis>).  The other
arguments are filled in as above.</para>

<para>The color map index for a dithered full color pixel is computed by
<function>dithergb</function>.
Since the pattern depends on the screen location, the first two
arguments
<emphasis remap='I'>x</emphasis>
and
<emphasis remap='I'>y</emphasis>,
specify that location.  The true color of the pixel at that location
is given by the triple
<emphasis remap='I'>r</emphasis>,
<emphasis remap='I'>g</emphasis>,
and
<emphasis remap='I'>b</emphasis>.
The number of intensity
<emphasis remap='I'>levels</emphasis>
and the dithering parameter matrices computed by
<function>dithermap</function>
are also passed to
<function>dithergb</function>.</para>

<para>The color map index for a dithered gray scale pixel is computed by
<function>ditherbw</function>.
Again, the screen position is specified, and the intensity value of
the pixel is supplied in
<emphasis remap='I'>val</emphasis>.
The dithering parameters must also be supplied.</para>

<para>Alternatively, the dithering may be done in line instead of incurring
the extra overhead of a function call, which can be significant when
repeated a million times.  The computation is as follows:</para>
<informaltable pgwide='0' frame='none'>
  <tgroup cols='4' align='center'>
    <colspec colname='c1'/>
    <colspec colname='c2'/>
    <colspec colname='c3'/>
    <colspec colname='c4'/>
    <tbody>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>row = y % 16;</entry>
        <entry align='left'></entry>
      </row>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>col = x % 16;</entry>
        <entry align='left'></entry>
      </row>
      <row>
        <entry align='left'></entry>
        <entry align='left'>#define DMAP(v,col,row) (divN[v] + (modN[v]&gt;magic[col][row] ? 1 : 0))</entry>
        <entry align='left'></entry>
        <entry align='left'></entry>
      </row>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>pix = DMAP(r,col,row) + DMAP(g,col,row)*levels +</entry>
        <entry align='left'></entry>
      </row>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>DMAP(b,col,row)*levels*levels;</entry>
      </row>
    </tbody>
  </tgroup>
</informaltable>


<para>For a gray scale image, it is a little simpler:</para>
<informaltable pgwide='0' frame='none'>
  <tgroup cols='3' align='center'>
    <colspec colname='c1'/>
    <colspec colname='c2'/>
    <colspec colname='c3'/>
    <tbody>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>pix = DMAP(val,row,col);</entry>
      </row>
    </tbody>
  </tgroup>
</informaltable>


<para>And on a single bit display (assuming a 1 means white):</para>
<informaltable pgwide='0' frame='none'>
  <tgroup cols='3' align='center'>
    <colspec colname='c1'/>
    <colspec colname='c2'/>
    <colspec colname='c3'/>
    <tbody>
      <row>
        <entry align='left'></entry>
        <entry align='left'></entry>
        <entry align='left'>pix = divN[val] &gt; magic[col][row] ? 1 : 0</entry>
      </row>
    </tbody>
  </tgroup>
</informaltable>


</refsect1>

<refsect1 xml:id='see_also'><title>SEE ALSO</title>
<para><citerefentry><refentrytitle>rgb_to_bw</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
<citerefentry><refentrytitle>librle</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
<citerefentry><refentrytitle>RLE</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
</refsect1>

<refsect1 xml:id='author'><title>AUTHOR</title>
<para>Spencer W. Thomas
<!-- .br -->
University of Utah</para>
</refsect1>
</refentry>

