<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- lifted from troff+man+tkman by doclifter -->
<refentry xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en' xml:id='crterrhdlr3'>

<!-- '\" Copyright (c) 1990 The Regents of the University of California.
'\" Copyright (c) 1994\-1996 Sun Microsystems, Inc. -->

<!-- '\" See the file "license.terms" for information on usage and redistribution
'\" of this file, and for a DISCLAIMER OF ALL WARRANTIES.
'\" 
'\" RCS: @(#) $Id$
'\"  -->
<refmeta>
<refentrytitle>Tk_CreateErrorHandler</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo class='manual'>Tk</refmiscinfo>
</refmeta>
<refnamediv>
<refname>Tk_CreateErrorHandler</refname>
<refname>Tk_DeleteErrorHandler</refname>
<refpurpose>handle X protocol errors</refpurpose>
</refnamediv>
<!-- body begins here -->
<refsynopsisdiv xml:id='synopsis'>
<funcsynopsis>
<funcsynopsisinfo>
#include &lt;tk.h&gt;

</funcsynopsisinfo>
<funcprototype>
<funcdef>Tk_ErrorHandler <function>Tk_CreateErrorHandler</function></funcdef>
<paramdef><parameter>display</parameter></paramdef>
<paramdef><parameter>error</parameter></paramdef>
<paramdef><parameter>request</parameter></paramdef>
<paramdef><parameter>minor</parameter></paramdef>
<paramdef><parameter>proc</parameter></paramdef>
<paramdef><parameter>clientData</parameter></paramdef>
</funcprototype>
<funcprototype>
<funcdef><function>Tk_DeleteErrorHandler</function></funcdef>
<paramdef><parameter>handler</parameter></paramdef>
</funcprototype>
</funcsynopsis>
</refsynopsisdiv>


<refsect1 xml:id='arguments'><title>ARGUMENTS</title>
<!-- .AS Tk_ErrorHandler clientData -->
<informaltable>
<tgroup cols='3'>
<tbody>

<row><entry>"Display"</entry><entry>"*display"</entry><entry>"in"</entry>
<entry>
<para>Display whose errors are to be handled.</para>
</entry>
</row>
<row><entry>int</entry><entry>error</entry><entry>in</entry>
<entry>
<para>Match only error events with this value in the <emphasis remap='I'>error_code</emphasis>
field.  If -1, then match any <emphasis remap='I'>error_code</emphasis> value.</para>
</entry>
</row>
<row><entry>int</entry><entry>request</entry><entry>in</entry>
<entry>
<para>Match only error events with this value in the <emphasis remap='I'>request_code</emphasis>
field.  If -1, then match any <emphasis remap='I'>request_code</emphasis> value.</para>
</entry>
</row>
<row><entry>int</entry><entry>minor</entry><entry>in</entry>
<entry>
<para>Match only error events with this value in the <emphasis remap='I'>minor_code</emphasis>
field.  If -1, then match any <emphasis remap='I'>minor_code</emphasis> value.</para>
</entry>
</row>
<row><entry>Tk_ErrorProc</entry><entry>*proc</entry><entry>in</entry>
<entry>
<para>Procedure to invoke whenever an error event is received for
<emphasis remap='I'>display</emphasis> and matches <emphasis remap='I'>error</emphasis>, <emphasis remap='I'>request</emphasis>, and <emphasis remap='I'>minor</emphasis>.
NULL means ignore any matching errors.</para>
</entry>
</row>
<row><entry>ClientData</entry><entry>clientData</entry><entry>in</entry>
<entry>
<para>Arbitrary one-word value to pass to <emphasis remap='I'>proc</emphasis>.</para>
</entry>
</row>
<row><entry>Tk_ErrorHandler</entry><entry>handler</entry><entry>in</entry>
<entry>
<para>Token for error handler to delete (return value from a previous
call to <function>Tk_CreateErrorHandler</function>).</para>
<!-- .BE -->
</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</refsect1>

<refsect1 xml:id='description'><title>DESCRIPTION</title>
<para><function>Tk_CreateErrorHandler</function> arranges for a particular procedure
(<emphasis remap='I'>proc</emphasis>) to be called whenever certain protocol errors occur on a
particular display (<emphasis remap='I'>display</emphasis>).  Protocol errors occur when
the X protocol is used incorrectly, such as attempting to map a window
that does not exist.  See the Xlib documentation for <emphasis remap='B'>XSetErrorHandler</emphasis>
for more information on the kinds of errors that can occur.
For <emphasis remap='I'>proc</emphasis> to be invoked
to handle a particular error, five things must occur:</para>
<variablelist remap='IP'>
  <varlistentry>
  <term>[1]</term>
  <listitem>
<para>The error must pertain to <emphasis remap='I'>display</emphasis>.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term>[2]</term>
  <listitem>
<para>Either the <emphasis remap='I'>error</emphasis> argument to <function>Tk_CreateErrorHandler</function>
must have been -1, or the <emphasis remap='I'>error</emphasis> argument must match
the <emphasis remap='I'>error_code</emphasis> field from the error event.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term>[3]</term>
  <listitem>
<para>Either the <emphasis remap='I'>request</emphasis> argument to <function>Tk_CreateErrorHandler</function>
must have been -1, or the <emphasis remap='I'>request</emphasis> argument must match
the <emphasis remap='I'>request_code</emphasis> field from the error event.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term>[4]</term>
  <listitem>
<para>Either the <emphasis remap='I'>minor</emphasis> argument to <function>Tk_CreateErrorHandler</function>
must have been -1, or the <emphasis remap='I'>minor</emphasis> argument must match
the <emphasis remap='I'>minor_code</emphasis> field from the error event.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term>[5]</term>
  <listitem>
<para>The protocol request to which the error pertains must have been
made when the handler was active (see below for more information).</para>
  </listitem>
  </varlistentry>
</variablelist>

<para><emphasis remap='I'>Proc</emphasis> should have arguments and result that match the
following type:</para>
<programlisting remap='CS'>
<funcsynopsis>
<funcprototype>
<funcdef>typedef int <function>Tk_ErrorProc</function></funcdef>
    <paramdef>ClientData <parameter>clientData</parameter></paramdef>
    <paramdef>XErrorEvent * <parameter>errEventPtr</parameter></paramdef>
</funcprototype>
</funcsynopsis>
</programlisting> <!-- remap='CE' -->
<para>The <varname role='parameter'>clientData</varname> parameter to <emphasis remap='I'>proc</emphasis> is a copy of the <varname role='parameter'>clientData</varname>
argument given to <emphasis remap='B'>Tcl_CreateErrorHandler</emphasis> when the callback
was created.  Typically, <varname role='parameter'>clientData</varname> points to a data
structure containing application-specific information that is
needed to deal with the error.  <emphasis remap='I'>ErrEventPtr</emphasis> is
a pointer to the X error event.
The procedure <emphasis remap='I'>proc</emphasis> should return an integer value.  If it
returns 0 it means that <emphasis remap='I'>proc</emphasis> handled the error completely and there
is no need to take any other action for the error.  If it returns
non-zero it means <emphasis remap='I'>proc</emphasis> was unable to handle the error.</para>

<para>If a value of NULL is specified for <emphasis remap='I'>proc</emphasis>, all matching errors
will be ignored:  this will produce the same result as if a procedure
had been specified that always returns 0.</para>

<para>If more than more than one handler matches a particular error, then
they are invoked in turn.  The handlers will be invoked in reverse
order of creation:  most recently declared handler first.
If any handler returns 0, then subsequent (older) handlers will
not be invoked.  If no handler returns 0, then Tk invokes X's
default error handler, which prints an error message and aborts the
program.  If you wish to have a default handler that deals with errors
that no other handler can deal with, then declare it first.</para>

<para>The X documentation states that
<quote>the error handler should not call any functions (directly or indirectly) on the display that will generate protocol requests or that will look for input events.</quote>
This restriction applies to handlers declared by <function>Tk_CreateErrorHandler</function>;
disobey it at your own risk.</para>

<para><function>Tk_DeleteErrorHandler</function> may be called to delete a
previously-created error handler.  The <emphasis remap='I'>handler</emphasis> argument
identifies the error handler, and should be a value returned by
a previous call to <emphasis remap='B'>Tk_CreateEventHandler</emphasis>.</para>

<para>A particular error handler applies to errors resulting
from protocol requests generated between
the call to <function>Tk_CreateErrorHandler</function> and the call to
<function>Tk_DeleteErrorHandler</function>.  However, the actual callback
to <emphasis remap='I'>proc</emphasis> may not occur until after the <function>Tk_DeleteErrorHandler</function>
call, due to buffering in the client and server.
If an error event pertains to
a protocol request made just before calling <function>Tk_DeleteErrorHandler</function>,
then the error event may not have been processed
before the <function>Tk_DeleteErrorHandler</function>
call.  When this situation arises, Tk will save information about
the handler and
invoke the handler's <emphasis remap='I'>proc</emphasis> later when the error event
finally arrives.
If an application wishes to delete an error handler and know
for certain that all relevant errors have been processed,
it should first call <function>Tk_DeleteErrorHandler</function> and then
call <emphasis remap='B'>XSync</emphasis>;  this will flush out any buffered requests and errors,
but will result in a performance penalty because
it requires communication to and from the X server.  After the
<emphasis remap='B'>XSync</emphasis> call Tk is guaranteed not to call any error
handlers deleted before the <emphasis remap='B'>XSync</emphasis> call.</para>

<para>For the Tk error handling mechanism to work properly, it is essential
that application code never calls <emphasis remap='B'>XSetErrorHandler</emphasis> directly;
applications should use only <function>Tk_CreateErrorHandler</function>.</para>

</refsect1>

<refsect1 xml:id='keywords'><title>KEYWORDS</title>
<para>callback, error, event, handler</para>
</refsect1>
</refentry>

