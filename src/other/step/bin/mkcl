#!/bin/csh
###############################################################################
# To create a new Class Library based on an Express schema:
#
# - run the mkcl script like this:
#
#	mkcl express-file schema-name
#
# - the new library has the name schema-name.a
###############################################################################

#
# Usage: makeProbe express-file schema-name
#
###################################################################
# These lines need to be CHANGE to point to the location of 
# the SCL software

# Root of PDES software tree
set pdesRoot='/proj/pdevel/release/scl2'

# location of Fed-X-Plus
set fedXplus=$pdesRoot/arch-sun4/bin/fedex_plus
###################################################################

set origDir=`pwd`
echo " "
echo "Compiling a new schema"
echo " "
echo "express file = $1"
echo "schema name = $2"
echo "pdes root dir = $pdesRoot"
echo " "

if ( -d $pdesRoot ) then
else
echo "The variable for the pdes root directory needs to be set."
exit(-1)
endif

if ( -r $1 ) then
set expFile = `basename $1`
set expressPath = `dirname $1`
cd $expressPath
set fullExpPath = `pwd`
else
echo "The express file specified is not readable."
exit(-1)
endif

cd $pdesRoot/arch-sun4/ofiles

if ( -d $2 ) then
else
mkdir $2
endif

cd $pdesRoot/src/clSchemas

if ( -d $2 ) then
else
mkdir $2
endif

cd $2

#run fedex_plus on the Express schema to generate the C++ source code

$fedXplus -e $fullExpPath/$expFile

cd $pdesRoot/arch-sun4/ofiles/$2

# ----------------  Now ready to Generate the new class library  ----------

rm ./Makefile
cp ../Makefile.template  ./origMakefile

# edit  the makefile
cp $pdesRoot/src/clSchemas/$2/make_schema foo
sed -e "s/your-schema/$2/\
/include make_schema/r foo" origMakefile > Makefile
# remove droppings
chmod 644 origMakefile
rm origMakefile

echo " "
# compile the new library
make depend

echo " "
make schemacl

echo " "
echo " "
echo " "
echo "The library for $2 is made in $pdesRoot/arch-sun4/lib/libC$2.a "
#echo "to install it use"
#echo "	% mv  $pdesRoot/arch-sun4/ofiles/libC$2.a $pdesRoot/arch-sun4/lib/$2"

