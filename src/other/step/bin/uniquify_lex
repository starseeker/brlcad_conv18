#!/bin/sh
#
# $Id: uniquify_lex,v 1.1 1997/10/28 19:59:28 sauderd Exp $
#
# uniquify_lex
#
# Rename necessary globals in lex output so that global name
# collisions do not occur between distinct scanners.  yyfoo becomes
# fn_foo, where the scanner is named fnscan or fnlex, and is defined
# in fnscan.lex.c or fnlex.lex.c.
#
# by clark@cme.nist.gov (Steve Clark)
#
# this script is in the public domain, and is provided with
# absolutely no warranty
#
# $Log: uniquify_lex,v $
# Revision 1.1  1997/10/28 19:59:28  sauderd
# Initial revision
#
# Revision 1.0.1.2  1992/06/06  22:46:47  libes
# removed yywrap, instead make it static in applications (sorry, Steve)
#
# Revision 1.0.1.1  1992/01/23  03:03:31  libes
# copied from ~pdes
#
# Revision 1.5  1991/05/09  17:56:52  libes
# changed pattern to make work on DECstation (as per Gerard S.)
#
# Revision 1.4  1991/05/02  21:42:02  libes
# Added yywrap
#
# Revision 1.3  1991/04/26  18:55:32  libes
# Replaced =\{ and similar patterns to plain wildcard matches since
# sed thought they mean something else.  This also accounts for
# possibility of whitespace (which didn't match what was here)
# original.  I don't understand how earlier version EVER ran!
#

# derive scanner name from source file name
NAME=`echo $1 | sed -e 's/scan$//' -e 's/lex$//'`

cat $1.lex.c \
  | sed -e "s/yylex/${NAME}_yylex/g"\
	-e "s/yylval/${NAME}_yylval/g"\
	-e "s/YYSTYPE/${NAME}_YYSTYPE/g"\
	-e "s/yysptr/${NAME}_yysptr/g"\
	-e "s/yyvstop/${NAME}_yyvstop/g"\
	-e "s/yycrank/${NAME}_yycrank/g"\
	-e "s/yybgin/${NAME}_yybgin/g"\
	-e "s/yyprevious/${NAME}_yyprevious/g"\
	-e "s/yyextra/${NAME}_yyextra/g"\
	-e "s/yysvec/${NAME}_yysvec/g"\
	-e "s/yymatch/${NAME}_yymatch/g"\
	-e "s/yytop/${NAME}_yytop/g"\
	-e "s/^FILE \*yyin =.*stdin.*, \*yyout =.*stdout.*;$/extern FILE *yyin, *yyout;/"\
	-e "s/^int yylineno =1;$/extern int yylineno;/"\
	-e "s/^yy\([iu]\)nput/static yy\1nput/g"\
        -e "s/yyoutput/${NAME}_yyoutput/g"\
	-e "s/yyback/${NAME}_yyback/g"\
	-e "s/yylook/${NAME}_yylook/g"\
	-e "s/yyfnd/${NAME}_yyfnd/g"\
	-e "s/yyolsp/${NAME}_yyolsp/g"\
	-e "s/yylsp/${NAME}_yylsp/g"\
	-e "s/yyestate/${NAME}_yyestate/g"\
	-e "s/yylstate/${NAME}_yylstate/g"\
	-e "s/yytchar/${NAME}_yytchar/g"\
	-e "s/yysbuf/${NAME}_yysbuf/g"\
	-e "s/yymorfg/${NAME}_yymorfg/g"\
	-e "s/yytext/${NAME}_yytext/g"\
	-e "s/yyleng/${NAME}_yyleng/g"\
  > $1.c

rm $1.lex.c
