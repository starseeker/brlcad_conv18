CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
IF(COMMAND CMAKE_POLICY)
	CMAKE_POLICY(SET CMP0003 NEW)
ENDIF(COMMAND CMAKE_POLICY)

PROJECT(PERPLEX)

INCLUDE_DIRECTORIES(
	${CMAKE_CURRENT_BINARY_DIR}
	${CMAKE_CURRENT_SOURCE_DIR}
)

FIND_PACKAGE(LEMON)
FIND_PACKAGE(RE2C)

RE2C_TARGET(PERPLEX scanner.re ${CMAKE_CURRENT_BINARY_DIR}/scanner.c
	COMPILE_FLAGS "-c")
LEMON_TARGET(PERPLEX parser.y parser.c parser.h)
ADD_RE2C_LEMON_DEPENDENCY(PERPLEX PERPLEX)

set(perplex_sources
	${LEMON_PERPLEX_OUTPUT_SOURCE}
	${RE2C_PERPLEX_OUTPUTS}
	mbo_getopt.cpp
	perplex.cpp
)

INCLUDE(${BRLCAD_SOURCE_DIR}/misc/CMake/ResolveCompilerPaths.cmake)
CHECK_LIBRARY_EXISTS(m cos "" HAVE_MATH_LIB)
IF(HAVE_MATH_LIB)
	RESOLVE_LIBRARIES(M_LIBRARY "-lm")
ENDIF(HAVE_MATH_LIB)

BRLCAD_ADDEXEC(perplex "${perplex_sources}" "${M_LIBRARY}")
